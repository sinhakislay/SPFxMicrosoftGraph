{"version":3,"file":"ApiReportGenerator.js","sourceRoot":"","sources":["../../src/generators/ApiReportGenerator.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport * as ts from 'typescript';\r\nimport { Text, InternalError } from '@microsoft/node-core-library';\r\nimport { ReleaseTag } from '@microsoft/api-extractor-model';\r\n\r\nimport { Collector } from '../collector/Collector';\r\nimport { TypeScriptHelpers } from '../analyzer/TypeScriptHelpers';\r\nimport { Span } from '../analyzer/Span';\r\nimport { CollectorEntity } from '../collector/CollectorEntity';\r\nimport { AstDeclaration } from '../analyzer/AstDeclaration';\r\nimport { DeclarationMetadata } from '../collector/DeclarationMetadata';\r\nimport { AstImport } from '../analyzer/AstImport';\r\nimport { AstSymbol } from '../analyzer/AstSymbol';\r\nimport { ExtractorMessage } from '../api/ExtractorMessage';\r\nimport { StringWriter } from './StringWriter';\r\nimport { DtsEmitHelpers } from './DtsEmitHelpers';\r\n\r\nexport class ApiReportGenerator {\r\n  /**\r\n   * Compares the contents of two API files that were created using ApiFileGenerator,\r\n   * and returns true if they are equivalent.  Note that these files are not normally edited\r\n   * by a human; the \"equivalence\" comparison here is intended to ignore spurious changes that\r\n   * might be introduced by a tool, e.g. Git newline normalization or an editor that strips\r\n   * whitespace when saving.\r\n   */\r\n  public static areEquivalentApiFileContents(actualFileContent: string, expectedFileContent: string): boolean {\r\n    // NOTE: \"\\s\" also matches \"\\r\" and \"\\n\"\r\n    const normalizedActual: string = actualFileContent.replace(/[\\s]+/g, ' ');\r\n    const normalizedExpected: string = expectedFileContent.replace(/[\\s]+/g, ' ');\r\n    return normalizedActual === normalizedExpected;\r\n  }\r\n\r\n  public static generateReviewFileContent(collector: Collector): string {\r\n    const stringWriter: StringWriter = new StringWriter();\r\n\r\n    stringWriter.writeLine([\r\n      `## API Report File for \"${collector.workingPackage.name}\"`,\r\n      ``,\r\n      `> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).`,\r\n      ``\r\n    ].join('\\n'));\r\n\r\n    // Write the opening delimiter for the Markdown code fence\r\n    stringWriter.writeLine('```ts\\n');\r\n\r\n    // Emit the imports\r\n    let importsEmitted: boolean = false;\r\n    for (const entity of collector.entities) {\r\n      if (entity.astEntity instanceof AstImport) {\r\n        DtsEmitHelpers.emitImport(stringWriter, entity, entity.astEntity);\r\n        importsEmitted = true;\r\n      }\r\n    }\r\n\r\n    if (importsEmitted) {\r\n      stringWriter.writeLine();\r\n    }\r\n\r\n    // Emit the regular declarations\r\n    for (const entity of collector.entities) {\r\n      if (entity.exported) {\r\n\r\n        // First, collect the list of export names for this symbol.  When reporting messages with\r\n        // ExtractorMessage.properties.exportName, this will enable us to emit the warning comments alongside\r\n        // the associated export statement.\r\n        interface IExportToEmit {\r\n          readonly exportName: string;\r\n          readonly associatedMessages: ExtractorMessage[];\r\n        }\r\n        const exportsToEmit: Map<string, IExportToEmit> = new Map<string, IExportToEmit>();\r\n\r\n        for (const exportName of entity.exportNames) {\r\n          if (!entity.shouldInlineExport) {\r\n            exportsToEmit.set(exportName, { exportName, associatedMessages: [] });\r\n          }\r\n        }\r\n\r\n        if (entity.astEntity instanceof AstSymbol) {\r\n          // Emit all the declarations for this entity\r\n          for (const astDeclaration of entity.astEntity.astDeclarations || []) {\r\n\r\n            // Get the messages associated with this declaration\r\n            const fetchedMessages: ExtractorMessage[] = collector.messageRouter\r\n              .fetchAssociatedMessagesForReviewFile(astDeclaration);\r\n\r\n            // Peel off the messages associated with an export statement and store them\r\n            // in IExportToEmit.associatedMessages (to be processed later).  The remaining messages will\r\n            // added to messagesToReport, to be emitted next to the declaration instead of the export statement.\r\n            const messagesToReport: ExtractorMessage[] = [];\r\n            for (const message of fetchedMessages) {\r\n              if (message.properties.exportName) {\r\n                const exportToEmit: IExportToEmit | undefined = exportsToEmit.get(message.properties.exportName);\r\n                if (exportToEmit) {\r\n                  exportToEmit.associatedMessages.push(message);\r\n                  continue;\r\n                }\r\n              }\r\n              messagesToReport.push(message);\r\n            }\r\n\r\n            stringWriter.write(ApiReportGenerator._getAedocSynopsis(collector, astDeclaration, messagesToReport));\r\n\r\n            const span: Span = new Span(astDeclaration.declaration);\r\n\r\n            const declarationMetadata: DeclarationMetadata = collector.fetchMetadata(astDeclaration);\r\n            if (declarationMetadata.isPreapproved) {\r\n              ApiReportGenerator._modifySpanForPreapproved(span);\r\n            } else {\r\n              ApiReportGenerator._modifySpan(collector, span, entity, astDeclaration, false);\r\n            }\r\n\r\n            span.writeModifiedText(stringWriter.stringBuilder);\r\n            stringWriter.writeLine('\\n');\r\n          }\r\n        }\r\n\r\n        // Now emit the export statements for this entity.\r\n        for (const exportToEmit of exportsToEmit.values()) {\r\n          // Write any associated messages\r\n          for (const message of exportToEmit.associatedMessages) {\r\n            ApiReportGenerator._writeLineAsComments(stringWriter,\r\n              'Warning: ' + message.formatMessageWithoutLocation());\r\n          }\r\n\r\n          DtsEmitHelpers.emitNamedExport(stringWriter, exportToEmit.exportName, entity);\r\n          stringWriter.writeLine();\r\n        }\r\n      }\r\n    }\r\n\r\n    DtsEmitHelpers.emitStarExports(stringWriter, collector);\r\n\r\n    // Write the unassociated warnings at the bottom of the file\r\n    const unassociatedMessages: ExtractorMessage[] = collector.messageRouter\r\n      .fetchUnassociatedMessagesForReviewFile();\r\n    if (unassociatedMessages.length > 0) {\r\n      stringWriter.writeLine();\r\n      ApiReportGenerator._writeLineAsComments(stringWriter, 'Warnings were encountered during analysis:');\r\n      ApiReportGenerator._writeLineAsComments(stringWriter, '');\r\n      for (const unassociatedMessage of unassociatedMessages) {\r\n        ApiReportGenerator._writeLineAsComments(stringWriter, unassociatedMessage.formatMessageWithLocation(\r\n          collector.workingPackage.packageFolder\r\n        ));\r\n      }\r\n    }\r\n\r\n    if (collector.workingPackage.tsdocComment === undefined) {\r\n      stringWriter.writeLine();\r\n      ApiReportGenerator._writeLineAsComments(stringWriter, '(No @packageDocumentation comment for this package)');\r\n    }\r\n\r\n    // Write the closing delimiter for the Markdown code fence\r\n    stringWriter.writeLine('\\n```');\r\n\r\n    return stringWriter.toString();\r\n  }\r\n\r\n  /**\r\n   * Before writing out a declaration, _modifySpan() applies various fixups to make it nice.\r\n   */\r\n  private static _modifySpan(collector: Collector, span: Span, entity: CollectorEntity,\r\n    astDeclaration: AstDeclaration, insideTypeLiteral: boolean): void {\r\n\r\n    // Should we process this declaration at all?\r\n    if ((astDeclaration.modifierFlags & ts.ModifierFlags.Private) !== 0) { // tslint:disable-line:no-bitwise\r\n      span.modification.skipAll();\r\n      return;\r\n    }\r\n\r\n    const previousSpan: Span | undefined = span.previousSibling;\r\n\r\n    let recurseChildren: boolean = true;\r\n    let sortChildren: boolean = false;\r\n\r\n    switch (span.kind) {\r\n      case ts.SyntaxKind.JSDocComment:\r\n        span.modification.skipAll();\r\n        // For now, we don't transform JSDoc comment nodes at all\r\n        recurseChildren = false;\r\n        break;\r\n\r\n      case ts.SyntaxKind.ExportKeyword:\r\n      case ts.SyntaxKind.DefaultKeyword:\r\n      case ts.SyntaxKind.DeclareKeyword:\r\n        // Delete any explicit \"export\" or \"declare\" keywords -- we will re-add them below\r\n        span.modification.skipAll();\r\n        break;\r\n\r\n      case ts.SyntaxKind.InterfaceKeyword:\r\n      case ts.SyntaxKind.ClassKeyword:\r\n      case ts.SyntaxKind.EnumKeyword:\r\n      case ts.SyntaxKind.NamespaceKeyword:\r\n      case ts.SyntaxKind.ModuleKeyword:\r\n      case ts.SyntaxKind.TypeKeyword:\r\n      case ts.SyntaxKind.FunctionKeyword:\r\n        // Replace the stuff we possibly deleted above\r\n        let replacedModifiers: string = '';\r\n\r\n        if (entity.shouldInlineExport) {\r\n          replacedModifiers = 'export ' + replacedModifiers;\r\n        }\r\n\r\n        if (previousSpan && previousSpan.kind === ts.SyntaxKind.SyntaxList) {\r\n          // If there is a previous span of type SyntaxList, then apply it before any other modifiers\r\n          // (e.g. \"abstract\") that appear there.\r\n          previousSpan.modification.prefix = replacedModifiers + previousSpan.modification.prefix;\r\n        } else {\r\n          // Otherwise just stick it in front of this span\r\n          span.modification.prefix = replacedModifiers + span.modification.prefix;\r\n        }\r\n        break;\r\n\r\n      case ts.SyntaxKind.SyntaxList:\r\n        if (span.parent) {\r\n          if (AstDeclaration.isSupportedSyntaxKind(span.parent.kind)) {\r\n            // If the immediate parent is an API declaration, and the immediate children are API declarations,\r\n            // then sort the children alphabetically\r\n            sortChildren = true;\r\n          } else if (span.parent.kind === ts.SyntaxKind.ModuleBlock) {\r\n            // Namespaces are special because their chain goes ModuleDeclaration -> ModuleBlock -> SyntaxList\r\n            sortChildren = true;\r\n          }\r\n        }\r\n        break;\r\n\r\n        case ts.SyntaxKind.VariableDeclaration:\r\n        if (!span.parent) {\r\n          // The VariableDeclaration node is part of a VariableDeclarationList, however\r\n          // the Entry.followedSymbol points to the VariableDeclaration part because\r\n          // multiple definitions might share the same VariableDeclarationList.\r\n          //\r\n          // Since we are emitting a separate declaration for each one, we need to look upwards\r\n          // in the ts.Node tree and write a copy of the enclosing VariableDeclarationList\r\n          // content (e.g. \"var\" from \"var x=1, y=2\").\r\n          const list: ts.VariableDeclarationList | undefined = TypeScriptHelpers.matchAncestor(span.node,\r\n            [ts.SyntaxKind.VariableDeclarationList, ts.SyntaxKind.VariableDeclaration]);\r\n          if (!list) {\r\n            // This should not happen unless the compiler API changes somehow\r\n            throw new InternalError('Unsupported variable declaration');\r\n          }\r\n          const listPrefix: string = list.getSourceFile().text\r\n            .substring(list.getStart(), list.declarations[0].getStart());\r\n          span.modification.prefix = listPrefix + span.modification.prefix;\r\n          span.modification.suffix = ';';\r\n\r\n          if (entity.shouldInlineExport) {\r\n            span.modification.prefix = 'export ' + span.modification.prefix;\r\n          }\r\n        }\r\n        break;\r\n\r\n      case ts.SyntaxKind.Identifier:\r\n        const referencedEntity: CollectorEntity | undefined = collector.tryGetEntityForIdentifierNode(\r\n          span.node as ts.Identifier\r\n        );\r\n\r\n        if (referencedEntity) {\r\n          if (!referencedEntity.nameForEmit) {\r\n            // This should never happen\r\n            throw new InternalError('referencedEntry.nameForEmit is undefined');\r\n          }\r\n\r\n          span.modification.prefix = referencedEntity.nameForEmit;\r\n          // For debugging:\r\n          // span.modification.prefix += '/*R=FIX*/';\r\n        } else {\r\n          // For debugging:\r\n          // span.modification.prefix += '/*R=KEEP*/';\r\n        }\r\n\r\n        break;\r\n\r\n      case ts.SyntaxKind.TypeLiteral:\r\n        insideTypeLiteral = true;\r\n        break;\r\n    }\r\n\r\n    if (recurseChildren) {\r\n      for (const child of span.children) {\r\n        let childAstDeclaration: AstDeclaration = astDeclaration;\r\n\r\n        if (AstDeclaration.isSupportedSyntaxKind(child.kind)) {\r\n          childAstDeclaration = collector.astSymbolTable.getChildAstDeclarationByNode(child.node, astDeclaration);\r\n\r\n          if (sortChildren) {\r\n            span.modification.sortChildren = true;\r\n            child.modification.sortKey = Collector.getSortKeyIgnoringUnderscore(\r\n              childAstDeclaration.astSymbol.localName);\r\n          }\r\n\r\n          if (!insideTypeLiteral) {\r\n            const messagesToReport: ExtractorMessage[] = collector.messageRouter\r\n              .fetchAssociatedMessagesForReviewFile(childAstDeclaration);\r\n            const aedocSynopsis: string = ApiReportGenerator._getAedocSynopsis(collector, childAstDeclaration,\r\n              messagesToReport);\r\n            const indentedAedocSynopsis: string = ApiReportGenerator._addIndentAfterNewlines(aedocSynopsis,\r\n              child.getIndent());\r\n\r\n            child.modification.prefix = indentedAedocSynopsis + child.modification.prefix;\r\n          }\r\n        }\r\n\r\n        ApiReportGenerator._modifySpan(collector, child, entity, childAstDeclaration, insideTypeLiteral);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * For declarations marked as `@preapproved`, this is used instead of _modifySpan().\r\n   */\r\n  private static _modifySpanForPreapproved(span: Span): void {\r\n    // Match something like this:\r\n    //\r\n    //   ClassDeclaration:\r\n    //     SyntaxList:\r\n    //       ExportKeyword:  pre=[export] sep=[ ]\r\n    //       DeclareKeyword:  pre=[declare] sep=[ ]\r\n    //     ClassKeyword:  pre=[class] sep=[ ]\r\n    //     Identifier:  pre=[_PreapprovedClass] sep=[ ]\r\n    //     FirstPunctuation:  pre=[{] sep=[\\n\\n    ]\r\n    //     SyntaxList:\r\n    //       ...\r\n    //     CloseBraceToken:  pre=[}]\r\n    //\r\n    // or this:\r\n    //   ModuleDeclaration:\r\n    //     SyntaxList:\r\n    //       ExportKeyword:  pre=[export] sep=[ ]\r\n    //       DeclareKeyword:  pre=[declare] sep=[ ]\r\n    //     NamespaceKeyword:  pre=[namespace] sep=[ ]\r\n    //     Identifier:  pre=[_PreapprovedNamespace] sep=[ ]\r\n    //     ModuleBlock:\r\n    //       FirstPunctuation:  pre=[{] sep=[\\n\\n    ]\r\n    //       SyntaxList:\r\n    //         ...\r\n    //       CloseBraceToken:  pre=[}]\r\n    //\r\n    // And reduce it to something like this:\r\n    //\r\n    //   // @internal (undocumented)\r\n    //   class _PreapprovedClass { /* (preapproved) */ }\r\n    //\r\n\r\n    let skipRest: boolean = false;\r\n    for (const child of span.children) {\r\n      if (skipRest\r\n        || child.kind === ts.SyntaxKind.SyntaxList\r\n        || child.kind === ts.SyntaxKind.JSDocComment) {\r\n        child.modification.skipAll();\r\n      }\r\n      if (child.kind === ts.SyntaxKind.Identifier) {\r\n        skipRest = true;\r\n        child.modification.omitSeparatorAfter = true;\r\n        child.modification.suffix = ' { /* (preapproved) */ }';\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Writes a synopsis of the AEDoc comments, which indicates the release tag,\r\n   * whether the item has been documented, and any warnings that were detected\r\n   * by the analysis.\r\n   */\r\n  private static _getAedocSynopsis(collector: Collector, astDeclaration: AstDeclaration,\r\n    messagesToReport: ExtractorMessage[]): string {\r\n    const stringWriter: StringWriter = new StringWriter();\r\n\r\n    for (const message of messagesToReport) {\r\n      ApiReportGenerator._writeLineAsComments(stringWriter, 'Warning: ' + message.formatMessageWithoutLocation());\r\n    }\r\n\r\n    const footerParts: string[] = [];\r\n    const declarationMetadata: DeclarationMetadata = collector.fetchMetadata(astDeclaration);\r\n    if (!declarationMetadata.releaseTagSameAsParent) {\r\n      if (declarationMetadata.effectiveReleaseTag !== ReleaseTag.None) {\r\n        footerParts.push(ReleaseTag.getTagName(declarationMetadata.effectiveReleaseTag));\r\n      }\r\n    }\r\n\r\n    if (declarationMetadata.isSealed) {\r\n      footerParts.push('@sealed');\r\n    }\r\n\r\n    if (declarationMetadata.isVirtual) {\r\n      footerParts.push('@virtual');\r\n    }\r\n\r\n    if (declarationMetadata.isOverride) {\r\n      footerParts.push('@override');\r\n    }\r\n\r\n    if (declarationMetadata.isEventProperty) {\r\n      footerParts.push('@eventProperty');\r\n    }\r\n\r\n    if (declarationMetadata.tsdocComment) {\r\n      if (declarationMetadata.tsdocComment.deprecatedBlock) {\r\n        footerParts.push('@deprecated');\r\n      }\r\n    }\r\n\r\n    if (declarationMetadata.needsDocumentation) {\r\n      footerParts.push('(undocumented)');\r\n    }\r\n\r\n    if (footerParts.length > 0) {\r\n      if (messagesToReport.length > 0) {\r\n        ApiReportGenerator._writeLineAsComments(stringWriter, ''); // skip a line after the warnings\r\n      }\r\n\r\n      ApiReportGenerator._writeLineAsComments(stringWriter, footerParts.join(' '));\r\n    }\r\n\r\n    return stringWriter.toString();\r\n  }\r\n\r\n  private static _writeLineAsComments(stringWriter: StringWriter, line: string): void {\r\n    const lines: string[] = Text.convertToLf(line).split('\\n');\r\n    for (const realLine of lines) {\r\n      stringWriter.write('// ');\r\n      stringWriter.write(realLine);\r\n      stringWriter.writeLine();\r\n    }\r\n  }\r\n\r\n  private static _addIndentAfterNewlines(text: string, indent: string): string {\r\n    if (text.length === 0 || indent.length === 0) {\r\n      return text;\r\n    }\r\n    return Text.replaceAll(text, '\\n', '\\n' + indent);\r\n  }\r\n\r\n}\r\n"]}