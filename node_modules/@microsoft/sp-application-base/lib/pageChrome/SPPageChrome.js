import { Validate } from '@microsoft/sp-core-library';
import { _SPLoaderFlights } from '@microsoft/sp-loader';
import { Flights } from '../common/Flights';
import SPThemeProvider from './SPThemeProvider';
import SPGlobalErrorHandler from '../error/SPGlobalErrorHandler';
import DialogManagerConfiguration from '../extensibility/DialogManagerConfiguration';
import { _PerformanceLogger } from '@ms/sp-telemetry';
import styles from './SPPageChrome.module.scss';
var SPPageChrome = /** @class */ (function () {
    function SPPageChrome(serviceScope, parentChrome) {
        this._isDisposed = false;
        this._masterChrome = parentChrome;
        this._createPageChrome();
        // The default configuration for dialog manager. This may be changed by the application later.
        // Note: This will not run if the application does not own the page chrome and hence must be called
        // by the application if they choose to use the dialog manager.
        DialogManagerConfiguration.instance.initialize(this.dialogContainerDiv);
        this._spThemeProvider = new SPThemeProvider(serviceScope);
    }
    SPPageChrome.prototype.changeSuiteNavHeight = function (pixels) {
        var top = parseInt(pixels, 10) + 'px';
        this.suiteNavDiv.style.height = top;
    };
    Object.defineProperty(SPPageChrome.prototype, "themeProvider", {
        get: function () {
            return this._spThemeProvider;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Shows the page chrome in the current document.
     */
    SPPageChrome.prototype.show = function () {
        if (!this._isDisposed) {
            if (Flights.useNewChromeSequence()) {
                this._masterChrome.show();
                if (!Flights.useNextGenSPA) {
                    this._masterChrome.chromeDiv.appendChild(this.appAndPropertyPaneDiv);
                    this._masterChrome.chromeDiv.appendChild(this.dialogContainerDiv);
                }
            }
            else {
                document.body.appendChild(this._chromeDiv);
            }
        }
    };
    /**
     * Hides the page chrome in the current document.
     */
    SPPageChrome.prototype.hide = function () {
        if (!this._isDisposed) {
            if (Flights.useNewChromeSequence()) {
                if (!Flights.useNextGenSPA) {
                    this.appAndPropertyPaneDiv = this._masterChrome.chromeDiv.removeChild(this.appAndPropertyPaneDiv);
                    this.dialogContainerDiv = this._masterChrome.chromeDiv.removeChild(this.dialogContainerDiv);
                }
            }
            else {
                this._chromeDiv = document.body.removeChild(this._chromeDiv);
            }
        }
    };
    /**
     * Disposes the Chrome
     */
    SPPageChrome.prototype.dispose = function () {
        if (_SPLoaderFlights._useNewBootSequence() && !this._isDisposed) {
            delete this.appDiv;
            delete this.propertyPaneContainerDiv;
            if (this.appAndPropertyPaneDiv) {
                delete this.appAndPropertyPaneDiv;
            }
            delete this.dialogContainerDiv;
            if (!Flights.useNewChromeSequence()) {
                delete this.suiteNavDiv;
                delete this._chromeDiv;
            }
        }
        this._isDisposed = true;
    };
    Object.defineProperty(SPPageChrome.prototype, "isDisposed", {
        /**
         * Returns true if the object has already been disposed, otherwise false.
         */
        get: function () {
            return this._isDisposed;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Creates div elements that are used to render the Standard Page Chrome for
     * client-side applications. The structure of the Page Chrome is:
     *
     * SPPageChrome - Parent div for client-side applications
     * -SuiteNav - O365 SuiteNav
     * --App - Div Element where the application will be rendered.
     */
    SPPageChrome.prototype._createPageChrome = function () {
        _PerformanceLogger.devMark('SPPageChrome.createPageChrome');
        if (Flights.useNewChromeSequence()) {
            Validate.isNotNullOrUndefined(this._masterChrome, 'masterChrome');
            Validate.isNotDisposed(this._masterChrome, 'masterChrome');
            Validate.isNotNullOrUndefined(this._masterChrome.chromeDiv, 'chromeDiv');
            Validate.isNotNullOrUndefined(this._masterChrome.suiteNavDiv, 'suiteNavDiv');
            this.suiteNavDiv = this._masterChrome.suiteNavDiv;
        }
        else {
            // Page body
            document.body.className = 'ms-font-m';
            // Page Chrome div
            this._chromeDiv = document.createElement('div');
            this._chromeDiv.setAttribute('class', 'SPPageChrome');
            // SuiteNav div
            this.suiteNavDiv = document.createElement('div');
            this.suiteNavDiv.setAttribute('id', 'SuiteNavPlaceHolder');
            this._chromeDiv.appendChild(this.suiteNavDiv);
        }
        // Application div
        this.appDiv = document.createElement('div');
        this.appDiv.setAttribute('class', "SPPageChrome-app");
        this.appDiv.setAttribute('id', 'spPageChromeAppDiv');
        this.appDiv.setAttribute('data-sp-feature-tag', 'Page Chrome');
        this.appDiv.setAttribute('data-sp-feature-instance-id', '_Page Chrome');
        this.appDiv.setAttribute('data-sp-a11y-navigatebyhierarchy', 'true');
        // PropertyPaneContainer div
        this.propertyPaneContainerDiv = document.createElement('div');
        this.propertyPaneContainerDiv.setAttribute('class', "spPropertyPaneContainer " + styles.spPageContentTransition);
        this.propertyPaneContainerDiv.setAttribute('id', 'spPropertyPaneContainer');
        // Application and PropertyPane container div
        this.appAndPropertyPaneDiv = document.createElement('div');
        this.appAndPropertyPaneDiv.setAttribute('class', 'spAppAndPropertyPanelContainer');
        this.appAndPropertyPaneDiv.appendChild(this.appDiv);
        this.appAndPropertyPaneDiv.appendChild(this.propertyPaneContainerDiv);
        // Dialog Container Div
        this.dialogContainerDiv = document.createElement('div');
        this.dialogContainerDiv.setAttribute('id', 'spDialogContainerDiv');
        // Compose the page chrome
        if (!Flights.useNewChromeSequence()) {
            this._chromeDiv.appendChild(this.appAndPropertyPaneDiv);
            this._chromeDiv.appendChild(this.dialogContainerDiv);
            if (!window.onerror) {
                window.onerror = SPGlobalErrorHandler.basicTracingHandler;
            }
        }
        else if (Flights.useNextGenSPA) {
            this._masterChrome.chromeDiv.appendChild(this.appAndPropertyPaneDiv);
            this._masterChrome.chromeDiv.appendChild(this.dialogContainerDiv);
        }
    };
    return SPPageChrome;
}());
export default SPPageChrome;
//# sourceMappingURL=SPPageChrome.js.map