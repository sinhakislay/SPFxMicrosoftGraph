/**
 * This class builds specific errors for sp-loader.
 * This is short-hand for all the error creation, so the production code looks cleaner.
 */
import { _TraceLogger } from '@microsoft/sp-diagnostics';
import SPLoaderError, { SPLoaderErrorCode } from './SPLoaderError';
import * as telemetryConstants from '../utilities/telemetryConstants';
import strings from './Error.resx';
var loadComponentImplEventName = 'loadComponentImpl';
var ErrorBuilder = /** @class */ (function () {
    function ErrorBuilder() {
    }
    ErrorBuilder.buildLoadComponentError = function (manifest, error) {
        // <value>Failed to load component "{0}" ({1}).
        // Original error: {2}</value>
        return this.buildErrorWithVerboseLog(SPLoaderErrorCode.loadComponentError, error, false, telemetryConstants.loadComponentLogSource, loadComponentImplEventName, manifest.id, manifest.alias, error.message);
    };
    ErrorBuilder.buildLoadComponentReturnsEmptyError = function (manifest) {
        // <value>loadComponent() returned an empty object for component "{0}" ({1}).</value>
        return this.buildErrorWithVerboseLog(SPLoaderErrorCode.loadComponentReturnsEmptyError, undefined, false, telemetryConstants.loadComponentLogSource, loadComponentImplEventName, manifest.id, manifest.alias);
    };
    ErrorBuilder.buildLoadComponentReturnsDefaultEmptyError = function (manifest) {
        // <value>loadComponent() returned an object with an empty default property for component "{0}" ({1}).</value>
        return this.buildErrorWithVerboseLog(SPLoaderErrorCode.loadComponentReturnsDefaultEmptyError, undefined, false, telemetryConstants.loadComponentLogSource, loadComponentImplEventName, manifest.id, manifest.alias);
    };
    ErrorBuilder.buildLoadComponentDependencyError = function (manifest, error) {
        // <value>Failed to load component dependency "{0}" from component "{1}" ({2}).
        // Original error: {3}</value>
        return this.buildErrorWithVerboseLog(SPLoaderErrorCode.loadComponentDependencyError, error, false, telemetryConstants.loadComponentLogSource, loadComponentImplEventName, manifest.id, manifest.alias, error.message);
    };
    ErrorBuilder.buildManifestNotFoundError = function (moduleConfiguration) {
        // <value>Manifest not found for component id "{0}" and version "{1}".</value>
        return this.buildErrorWithVerboseLog(SPLoaderErrorCode.manifestNotFoundError, undefined, false, telemetryConstants.loadComponentLogSource, undefined, moduleConfiguration.id, moduleConfiguration.version);
    };
    ErrorBuilder.buildLoadPathDependencyBlockedError = function (manifest, name) {
        // tslint:disable-next-line:max-line-length
        // <value>Failed to load path dependency "{0}" from component "{1}" ({2}) due to another dependency that failed to load.</value>
        return this.buildErrorWithVerboseLog(SPLoaderErrorCode.loadPathDependencyBlockedByAnotherDependencyError, undefined, false, telemetryConstants.loadComponentLogSource, undefined, name, manifest.id, manifest.alias);
    };
    ErrorBuilder.buildModuleHasUndeclaredDependencyError = function (manifest, dependencyName) {
        // tslint:disable-next-line:max-line-length
        // <value>The entry point for component "{0}" ({1}) has a dependency on "{2}" that is not declared in the manifest.</value>
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.moduleHasUndeclaredDependencyError, undefined, true, // This is an error when building the manifest/JS so it's an expected error
        telemetryConstants.loadComponentLogSource, undefined, manifest.id, manifest.alias, dependencyName);
    };
    ErrorBuilder.buildLoadEntryPointError = function (manifest, error) {
        // <value>Failed to load entry point from component "{0}" ({1}).
        // Original error: {2}</value>
        return this.buildErrorWithVerboseLog(SPLoaderErrorCode.loadEntryPointError, error, false, telemetryConstants.loadComponentLogSource, undefined, manifest.id, manifest.alias, error.message);
    };
    ErrorBuilder.buildLoadPathDependencyError = function (manifest, dependencyName, error) {
        // <value>Failed to load path dependency "{0}" from component "{1}" ({2}).
        // Original error: {3}</value>
        return this.buildErrorWithVerboseLog(SPLoaderErrorCode.loadPathDependencyError, error, false, telemetryConstants.loadComponentLogSource, undefined, dependencyName, manifest.id, manifest.alias, error.message);
    };
    ErrorBuilder.buildMissingPathDependencyError = function (manifest, dependencyName) {
        // <value>Missing path dependency "{0}" from component "{1}" ({2}). Existing path dependencies: {3}</value>
        return this.buildErrorWithVerboseLog(SPLoaderErrorCode.missingPathDependencyError, undefined, true, telemetryConstants.loadComponentLogSource, undefined, dependencyName, manifest.id, manifest.alias, Object.keys(manifest.loaderConfig.scriptResources).join(strings.listSeparator));
    };
    ErrorBuilder.buildLoadComponentDependencyFailoverPathError = function (manifest, dependencyName, failoverPath, error) {
        // <value>Failed to load component dependency "{0}" with failover path "{1}" from component "{2}" ({3}).
        // Original error: {4}</value>
        return this.buildErrorWithVerboseLog(SPLoaderErrorCode.loadComponentDependencyFailoverPathError, error, false, telemetryConstants.loadComponentLogSource, undefined, dependencyName, failoverPath, manifest.id, manifest.alias, error.message);
    };
    ErrorBuilder.buildLoadScriptWithStringError = function () {
        // <value>loadScript function doesn't allow a string as 2nd parameter. Use ILoadScriptOptions instead.</value>
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.loadScriptWithStringError, undefined, true, // Expected error, as it is caused by a wrong input from the user
        telemetryConstants.loadScriptLogSource, undefined);
    };
    ErrorBuilder.buildUrlStatusLocalhostFileNotFoundError = function (manifest, resourceName, url) {
        // tslint:disable-next-line:max-line-length
        // <value>Failed to load URL '{3}' for resource '{2}' in component '{0}' ({1}). The file was not found in the server.
        // Make sure that you are running 'gulp serve'.</value>
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.urlStatusLocalhostFileNotFoundError, undefined, true, // Expected error, as it is caused by a user action (not running gulp serve)
        telemetryConstants.loadScriptLogSource, undefined, manifest.id, manifest.alias, resourceName, url);
    };
    ErrorBuilder.buildUrlStatusFileNotFoundError = function (manifest, resourceName, url) {
        // tslint:disable-next-line:max-line-length
        // <value>Failed to load URL '{3}' for resource '{2}' in component '{0}' ({1}). The file was not found in the server.</value>
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.urlStatusFileNotFoundError, undefined, true, // Expected error, as it is caused by a wrong URL in the manifest
        telemetryConstants.loadScriptLogSource, undefined, manifest.id, manifest.alias, resourceName, url);
    };
    ErrorBuilder.buildUrlStatusForbiddenError = function (manifest, resourceName, url) {
        // tslint:disable-next-line:max-line-length
        // <value>Failed to load URL '{3}' for resource '{2}' in component '{0}' ({1}). The access to the file is forbidden.</value>
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.urlStatusForbiddenError, undefined, true, // Expected error, as it is caused by accessing a URL/CDN without permission
        telemetryConstants.loadScriptLogSource, undefined, manifest.id, manifest.alias, resourceName, url);
    };
    ErrorBuilder.buildUrlStatusClientErrorError = function (manifest, resourceName, url) {
        // tslint:disable-next-line:max-line-length
        // <value>Failed to load URL '{3}' for resource '{2}' in component '{0}' ({1}). There was an error requesting the file.</value>
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.urlStatusClientErrorError, undefined, false, // Unexpected error
        telemetryConstants.loadScriptLogSource, undefined, manifest.id, manifest.alias, resourceName, url);
    };
    ErrorBuilder.buildUrlStatusServerErrorError = function (manifest, resourceName, url) {
        // tslint:disable-next-line:max-line-length
        // <value>Failed to load URL '{3}' for resource '{2}' in component '{0}' ({1}). There was a problem in the server.</value>
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.urlStatusServerErrorError, undefined, false, // Unexpected error
        telemetryConstants.loadScriptLogSource, undefined, manifest.id, manifest.alias, resourceName, url);
    };
    ErrorBuilder.buildUrlStatusLocalhostNetworkErrorError = function (manifest, resourceName, url) {
        // tslint:disable-next-line:max-line-length
        // <value>Failed to load URL '{3}' for resource '{2}' in component '{0}' ({1}). There was a network problem.
        // Make sure that you are running 'gulp serve' and you have run 'gulp trust-dev-cert'.</value>
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.urlStatusLocalhostNetworkErrorError, undefined, true, // Expected error, as it is caused by a user action (not running gulp serve)
        telemetryConstants.loadScriptLogSource, undefined, manifest.id, manifest.alias, resourceName, url);
    };
    ErrorBuilder.buildUrlStatusDocLibNetworkErrorError = function (manifest, resourceName, url) {
        // tslint:disable-next-line:max-line-length
        // <value>Failed to load URL '{3}' for resource '{2}' in component '{0}' ({1}). There was a network problem.</value>
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.urlStatusDocLibNetworkErrorError, undefined, true, // Expected error, as it is caused by the tenant admin not enabling CDN
        telemetryConstants.loadScriptLogSource, undefined, manifest.id, manifest.alias, resourceName, url);
    };
    ErrorBuilder.buildUrlStatusHttpsNetworkErrorError = function (manifest, resourceName, url) {
        // tslint:disable-next-line:max-line-length
        // <value>Failed to load URL '{3}' for resource '{2}' in component '{0}' ({1}). There was a network problem.
        // This may be a problem with a HTTPS certificate. Make sure you have the right certificate.</value>
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.urlStatusHttpsNetworkErrorError, undefined, true, telemetryConstants.loadScriptLogSource, undefined, manifest.id, manifest.alias, resourceName, url);
    };
    ErrorBuilder.buildUrlStatusNetworkErrorError = function (manifest, resourceName, url) {
        // tslint:disable-next-line:max-line-length
        // <value>Failed to load URL '{3}' for resource '{2}' in component '{0}' ({1}). There was a network problem.</value>
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.urlStatusNetworkErrorError, undefined, true, telemetryConstants.loadScriptLogSource, undefined, manifest.id, manifest.alias, resourceName, url);
    };
    ErrorBuilder.buildUrlStatusUndefinedError = function (manifest, resourceName, url) {
        // tslint:disable-next-line:max-line-length
        // <value>Failed to load URL '{3}' for resource '{2}' in component '{0}' ({1}) because of unknown problems.</value>
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.urlStatusUndefinedError, undefined, false, // Unexpected error
        telemetryConstants.loadScriptLogSource, undefined, manifest.id, manifest.alias, resourceName, url);
    };
    ErrorBuilder.buildScriptFailedToCreateGlobalError = function (globalName, scriptUrl) {
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.failedToCreateGlobalVariable, undefined, false, telemetryConstants.loadScriptLogSource, undefined, globalName, scriptUrl);
    };
    ErrorBuilder.buildModuleHasFailedDependencyError = function (resource, dependency) {
        // <value>Failed to load module '{0}' because dependency {1} was not loaded</value>
        return this.buildErrorWithErrorLog(SPLoaderErrorCode.dependencyLoadError, undefined, true, // Unexpected error
        telemetryConstants.loadScriptLogSource, undefined, resource, dependency);
    };
    ErrorBuilder.buildErrorWithVerboseLog = function (errorCode, innerError, isExpected, source, eventName) {
        var params = []; // tslint:disable-line:no-any
        for (var _i = 5 // tslint:disable-line:no-any
        ; _i < arguments.length // tslint:disable-line:no-any
        ; _i++ // tslint:disable-line:no-any
        ) {
            params[_i - 5] = arguments[_i]; // tslint:disable-line:no-any
        }
        var error = new (SPLoaderError.bind.apply(SPLoaderError, [void 0, errorCode, innerError, isExpected].concat(params)))();
        _TraceLogger.logVerbose(source, error.message, eventName);
        return error;
    };
    ErrorBuilder.buildErrorWithErrorLog = function (errorCode, innerError, isExpected, source, eventName) {
        var params = []; // tslint:disable-line:no-any
        for (var _i = 5 // tslint:disable-line:no-any
        ; _i < arguments.length // tslint:disable-line:no-any
        ; _i++ // tslint:disable-line:no-any
        ) {
            params[_i - 5] = arguments[_i]; // tslint:disable-line:no-any
        }
        var error = new (SPLoaderError.bind.apply(SPLoaderError, [void 0, errorCode, innerError, isExpected].concat(params)))();
        _TraceLogger.logError(source, error, eventName);
        return error;
    };
    return ErrorBuilder;
}());
export default ErrorBuilder;
//# sourceMappingURL=ErrorBuilder.js.map