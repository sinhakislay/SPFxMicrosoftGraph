import ensureDebugComponents from './ensureDebugComponents';
/**
 * State of whether debug is allowed or not. "Undefined" means we haven't asked,
 *  "false" means debug is prohibited, and "true" means debug is allowed.
 */
var _loaderResponse = undefined;
var _manifestsResponse = undefined;
var _debugAllowedPromise;
export function confirmDebugAllowed(options) {
    if (_requiresPrompt(options)) {
        if (!_debugAllowedPromise) {
            _debugAllowedPromise = new Promise(function (resolve) {
                // Download the prompt
                ensureDebugComponents().then(function (debugComponents) {
                    // Show the prompt
                    return debugComponents.showDebugPrompt(options).then(function (allowed) {
                        _debugAllowedPromise = undefined;
                        if (options.loaderRequested) {
                            _loaderResponse = allowed;
                        }
                        if (options.manifestsRequested) {
                            _manifestsResponse = allowed;
                        }
                        resolve(allowed);
                    });
                }).catch(console.error);
            });
            return _debugAllowedPromise;
        }
        else {
            throw new Error('Debug prompt is currently being shown and cannot be shown again until it has been dismissed.');
        }
    }
    else {
        return Promise.resolve(peekDebugAllowed(options));
    }
}
export function dangerouslyEnableDebug() {
    _loaderResponse = true;
    _manifestsResponse = true;
}
export function peekDebugAllowed(options) {
    return ((!options.loaderRequested || _loaderResponse === true) &&
        (!options.manifestsRequested || _manifestsResponse === true));
}
function _requiresPrompt(options) {
    // Only show the prompt if we don't already know if it's been approved or declined
    return ((options.loaderRequested && _loaderResponse === undefined) ||
        (options.manifestsRequested && _manifestsResponse === undefined));
}
//# sourceMappingURL=confirmDebugAllowed.js.map