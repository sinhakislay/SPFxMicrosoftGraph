import { ISPEventObserver, ServiceScope, SPEvent, SPEventArgs } from '@microsoft/sp-core-library';
import { IDynamicDataManager } from '../interfaces/IDynamicDataManager';
import { IDynamicDataSource } from '../interfaces/IDynamicDataSource';
/**
 * Manager for Dynamic Data in the Isolated scenario.
 * This holds a reference to the Dynamic Data Source and passes the data to the parent window's
 * DynamicDataManager through ParentIframeCommunicator.
 *
 * @remarks
 * Data sources can notify for changes within the data source or for a specific property.
 * Data consumers can register to both changes in a Dynamic Data source and a specific property within the source.
 * There are 3 events to handle this variety of situations:
 *
 * Notifying a change for a property triggers events for the specific propery and for "any" property
 * Notifying a change for the whole source triggers events for for "any" property and "all" properties.
 *
 * Registering for changes in a property register to events for the specific property and "all" properties.
 * Registering for changes in the whole source register to events for "any" properties.
 *
 * This ensures that regardless of how sources and consumers are configured, events will trigger once and only once for
 * each update within the data source.
 *
 * @internal
 */
export default class IsolatedDynamicDataManager implements IDynamicDataManager, ISPEventObserver {
    /**
     * Added the below 3 dummy public properties to make this class extend ISPEventObserver.
     */
    instanceId: string;
    /**
     * Component id for the IsolatedDynamicDataManager.
     */
    componentId: string;
    /**
     * Indicates whether the component is disposed or not.
     */
    isDisposed: boolean;
    private _existingSources;
    private _sourcesChangedEvent;
    constructor(serviceScope: ServiceScope);
    /**
     * Event that gets raised when the list of Dynamic Data Sources gets updated.
     * @eventproperty
     */
    readonly sourcesChangedEvent: SPEvent<SPEventArgs>;
    /**
     * Notifies the parent window that the Dynamic Data Source has been updated.
     * @param sourceId - Id of the Dynamic Data Source that is being updated.
     */
    notifySourceChanged(sourceId: string): void;
    /**
     * Notifies the parent window that the property in a Dynamic Data Source has been updated.
     * @param sourceId - Id of the Dynamic Data Source whose property is being updated.
     * @param propertyId - Id of the property that is being updated.
     */
    notifyPropertyChanged(sourceId: string, propertyId: string): void;
    /**
     * Registers a listener on the parent app's DynamicDataManager for updates
     * on a Dynamic Data Source.
     */
    registerSourceChanged(sourceId: string, observer: ISPEventObserver, callback: () => void): void;
    /**
     * Unregisters a listener for updates on a Dynamic Data Source.
     */
    unregisterSourceChanged(sourceId: string, observer: ISPEventObserver, callback: () => void): void;
    /**
     * Registers a listener for updates on a Dynamic Data Source.
     */
    registerPropertyChanged(sourceId: string, propertyId: string, observer: ISPEventObserver, callback: () => void): void;
    /**
     * Registers a listener for updates on a Dynamic Data Source.
     */
    unregisterPropertyChanged(sourceId: string, propertyId: string, observer: ISPEventObserver, callback: () => void): void;
    /**
     * Sends a message to the parent window, requesting for the current existing sources. When the
     * IsolatedDynamicDataManager receives the new list, it updates the existing list of sources and
     * notifies the listeners that the available sources have changed.
     *
     * @returns - A read-only array with all the existing Dynamic Data Sources.
     */
    getSources(): ReadonlyArray<IDynamicDataSource>;
    /**
     * Returns a Dynamic Data Source based on its id.
     * Returns undefined if the source doesn't exist.
     * @param sourceId - Id of the Dynamic Data Source.
     */
    tryGetSource(sourceId: string): IDynamicDataSource | undefined;
    /**
     * Sends the new Isolated Dynamic Data Source to the main page, to be added into main page's
     * DynamicDataManager's list of sources.
     * Local PageContext data source is not sent to the main page, as it would be irrelevant,
     * and hence maintained locally. This is because, when asked for the pageContext source from
     * the isolated page, PageContext from isolated page is returned, NOT the main pages'.
     *
     * @remarks
     * Throws an error if the source can't be added.
     *
     * @param source - Dynamic Data Source to add.
     */
    addSource(source: IDynamicDataSource): void;
    /**
     * Removes an existing Dynamic Data Source from the manager.
     * @param id - Id of the Dynamic Data Source.
     */
    removeSource(sourceId: string): void;
    /**
     * Added this api to make this class extend ISPEventObserver.
     * @internal
     */
    dispose(): void;
    /**
     * Handler to store all the received sources from the parent window.
     * @param message - Incoming message from the parent window's PostMessage.
     */
    private _onAllSourcesReceived;
    /**
     * Raises an event when the Dynamic Data Sources gets updated.
     * @remarks
     * The event is sticky because sources can be updated before there is anyone listening. This way all clients
     * will get notified that sources have been updated. Further updates are notified in real-time.
     */
    private _raiseSourcesChangedEvent;
    private _registerUnregisterEvents;
}
//# sourceMappingURL=IsolatedDynamicDataManager.d.ts.map