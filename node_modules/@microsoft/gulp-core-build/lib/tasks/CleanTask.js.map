{"version":3,"file":"CleanTask.js","sourceRoot":"","sources":["../../src/tasks/CleanTask.ts"],"names":[],"mappings":";AAAA,4FAA4F;AAC5F,2DAA2D;;AAE3D,yCAAsC;AAGtC,0EAAuE;AAGvE;;;;;GAKG;AACH,MAAa,SAAU,SAAQ,mBAAc;IAC3C;;OAEG;IACH;QACE,KAAK,CAAC,OAAO,CAAC,CAAC;IACjB,CAAC;IAED;;;;OAIG;IACI,WAAW,CAChB,IAAiB,EACjB,gBAAkD;QAElD,MAAM,EAAE,UAAU,EAAE,SAAS,EAAE,YAAY,EAAE,UAAU,EAAE,GAAiB,IAAI,CAAC,WAAW,CAAC;QAC3F,IAAI,UAAU,GAAa;YACzB,UAAU;YACV,SAAS;YACT,UAAU;SACX,CAAC;QAEF,IAAI,YAAY,EAAE;YAChB,UAAU,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;SAC/B;QAED,yEAAyE;QACzE,KAAK,MAAM,UAAU,IAAI,IAAI,CAAC,WAAW,CAAC,WAAW,IAAI,EAAE,EAAE;YAC3D,IAAI,UAAU,CAAC,aAAa,EAAE;gBAC5B,6DAA6D;gBAC7D,UAAU,GAAG,UAAU,CAAC,MAAM,CAAC,UAAU,CAAC,aAAa,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC,CAAC;aAC5E;SACF;QAED,MAAM,WAAW,GAA8B,EAAE,CAAC;QAElD,uEAAuE;QACvE,UAAU,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;YAC7B,IAAI,CAAC,CAAC,SAAS,EAAE;gBACf,WAAW,CAAC,SAAS,CAAC,GAAG,SAAS,CAAC;aACpC;QACH,CAAC,CAAC,CAAC;QAEH,mDAAmD;QACnD,UAAU,GAAG,EAAE,CAAC;QAChB,KAAK,MAAM,UAAU,IAAI,WAAW,EAAE;YACpC,IAAI,WAAW,CAAC,cAAc,CAAC,UAAU,CAAC,EAAE;gBAC1C,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;aAC7B;SACF;QAED,IAAI;YACF,yCAAmB,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC;YAC/C,gBAAgB,EAAE,CAAC;SACpB;QAAC,OAAO,CAAC,EAAE;YACV,gBAAgB,CAAC,CAAC,CAAC,CAAC;SACrB;IACH,CAAC;CACF;AA5DD,8BA4DC","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport { GulpTask } from './GulpTask';\r\nimport * as Gulp from 'gulp';\r\n\r\nimport { FileDeletionUtility } from '../utilities/FileDeletionUtility';\r\nimport { IBuildConfig } from './../IBuildConfig';\r\n\r\n/**\r\n * The clean task is a special task which iterates through all registered\r\n * tasks and subtasks, collecting a list of patterns which should be deleted.\r\n * An instance of this task is automatically registered to the 'clean' command.\r\n * @public\r\n */\r\nexport class CleanTask extends GulpTask<void> {\r\n  /**\r\n   * Instantiates a new CleanTask with the name 'clean'\r\n   */\r\n  constructor() {\r\n    super('clean');\r\n  }\r\n\r\n  /**\r\n   * The main function, which iterates through all uniqueTasks registered\r\n   * to the build, and by calling the getCleanMatch() function, collects a list of\r\n   * glob patterns which are then passed to the `del` plugin to delete them from disk.\r\n   */\r\n  public executeTask(\r\n    gulp: typeof Gulp,\r\n    completeCallback: (error?: string | Error) => void\r\n  ): void {\r\n    const { distFolder, libFolder, libAMDFolder, tempFolder }: IBuildConfig = this.buildConfig;\r\n    let cleanPaths: string[] = [\r\n      distFolder,\r\n      libFolder,\r\n      tempFolder\r\n    ];\r\n\r\n    if (libAMDFolder) {\r\n      cleanPaths.push(libAMDFolder);\r\n    }\r\n\r\n    // Give each registered task an opportunity to add their own clean paths.\r\n    for (const executable of this.buildConfig.uniqueTasks || []) {\r\n      if (executable.getCleanMatch) {\r\n        // Set the build config, as tasks need this to build up paths\r\n        cleanPaths = cleanPaths.concat(executable.getCleanMatch(this.buildConfig));\r\n      }\r\n    }\r\n\r\n    const uniquePaths: { [key: string]: string } = {};\r\n\r\n    // Create dictionary of unique paths. (Could be replaced with ES6 set.)\r\n    cleanPaths.forEach(cleanPath => {\r\n      if (!!cleanPath) {\r\n        uniquePaths[cleanPath] = cleanPath;\r\n      }\r\n    });\r\n\r\n    // Reset cleanPaths to only unique non-empty paths.\r\n    cleanPaths = [];\r\n    for (const uniquePath in uniquePaths) {\r\n      if (uniquePaths.hasOwnProperty(uniquePath)) {\r\n        cleanPaths.push(uniquePath);\r\n      }\r\n    }\r\n\r\n    try {\r\n      FileDeletionUtility.deletePatterns(cleanPaths);\r\n      completeCallback();\r\n    } catch (e) {\r\n      completeCallback(e);\r\n    }\r\n  }\r\n}"]}