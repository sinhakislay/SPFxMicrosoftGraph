"use strict";
// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.
// See LICENSE in the project root for license information.
Object.defineProperty(exports, "__esModule", { value: true });
const PublishUtilities_1 = require("./PublishUtilities");
class PublishGit {
    constructor(targetBranch) {
        this._targetBranch = targetBranch;
    }
    checkout(branchName, createBranch) {
        const params = `checkout ${createBranch ? '-b ' : ''}${branchName}`;
        PublishUtilities_1.PublishUtilities.execCommand(!!this._targetBranch, 'git', params.split(' '));
    }
    merge(branchName) {
        PublishUtilities_1.PublishUtilities.execCommand(!!this._targetBranch, 'git', `merge ${branchName} --no-edit`.split(' '));
    }
    deleteBranch(branchName, hasRemote = true) {
        PublishUtilities_1.PublishUtilities.execCommand(!!this._targetBranch, 'git', `branch -d ${branchName}`.split(' '));
        if (hasRemote) {
            PublishUtilities_1.PublishUtilities.execCommand(!!this._targetBranch, 'git', `push origin --delete ${branchName}`.split(' '));
        }
    }
    pull() {
        PublishUtilities_1.PublishUtilities.execCommand(!!this._targetBranch, 'git', `pull origin ${this._targetBranch}`.split(' '));
    }
    fetch() {
        PublishUtilities_1.PublishUtilities.execCommand(!!this._targetBranch, 'git', ['fetch', 'origin']);
    }
    addChanges(pathspec, workingDirectory) {
        const files = pathspec ? pathspec : '.';
        PublishUtilities_1.PublishUtilities.execCommand(!!this._targetBranch, 'git', ['add', files], workingDirectory ? workingDirectory : process.cwd());
    }
    addTag(shouldExecute, packageName, packageVersion) {
        // Tagging only happens if we're publishing to real NPM and committing to git.
        const tagName = PublishUtilities_1.PublishUtilities.createTagname(packageName, packageVersion);
        PublishUtilities_1.PublishUtilities.execCommand(!!this._targetBranch && shouldExecute, 'git', ['tag', '-a', tagName, '-m', `${packageName} v${packageVersion}`]);
    }
    commit(commitMessage) {
        PublishUtilities_1.PublishUtilities.execCommand(!!this._targetBranch, 'git', ['commit', '-m', commitMessage]);
    }
    push(branchName) {
        PublishUtilities_1.PublishUtilities.execCommand(!!this._targetBranch, 'git', 
        // We append "--no-verify" to prevent Git hooks from running.  For example, people may
        // want to invoke "rush change -v" as a pre-push hook.
        ['push', 'origin', 'HEAD:' + branchName, '--follow-tags', '--verbose', '--no-verify']);
    }
}
exports.PublishGit = PublishGit;
//# sourceMappingURL=PublishGit.js.map