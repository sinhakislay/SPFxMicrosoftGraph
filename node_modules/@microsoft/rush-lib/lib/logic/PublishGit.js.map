{"version":3,"file":"PublishGit.js","sourceRoot":"","sources":["../../src/logic/PublishGit.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n// See LICENSE in the project root for license information.\r\n\r\nimport { PublishUtilities } from './PublishUtilities';\r\n\r\nexport class PublishGit {\r\n  private _targetBranch: string | undefined;\r\n\r\n  constructor(targetBranch: string | undefined) {\r\n\r\n    this._targetBranch = targetBranch;\r\n  }\r\n\r\n  public checkout(branchName: string | undefined, createBranch?: boolean): void {\r\n    const params: string = `checkout ${createBranch ? '-b ' : ''}${branchName}`;\r\n\r\n    PublishUtilities.execCommand(!!this._targetBranch, 'git', params.split(' '));\r\n  }\r\n\r\n  public merge(branchName: string): void {\r\n    PublishUtilities.execCommand(!!this._targetBranch, 'git', `merge ${branchName} --no-edit`.split(' '));\r\n  }\r\n\r\n  public deleteBranch(branchName: string, hasRemote: boolean = true): void {\r\n    PublishUtilities.execCommand(!!this._targetBranch, 'git', `branch -d ${branchName}`.split(' '));\r\n    if (hasRemote) {\r\n      PublishUtilities.execCommand(!!this._targetBranch, 'git', `push origin --delete ${branchName}`.split(' '));\r\n    }\r\n  }\r\n\r\n  public pull(): void {\r\n    PublishUtilities.execCommand(!!this._targetBranch, 'git', `pull origin ${this._targetBranch}`.split(' '));\r\n  }\r\n\r\n  public fetch(): void {\r\n    PublishUtilities.execCommand(!!this._targetBranch, 'git', ['fetch', 'origin']);\r\n  }\r\n\r\n  public addChanges(pathspec?: string, workingDirectory?: string): void {\r\n    const files: string = pathspec ? pathspec : '.';\r\n    PublishUtilities.execCommand(!!this._targetBranch, 'git', ['add', files],\r\n      workingDirectory ? workingDirectory : process.cwd());\r\n  }\r\n\r\n  public addTag(shouldExecute: boolean, packageName: string, packageVersion: string): void {\r\n    // Tagging only happens if we're publishing to real NPM and committing to git.\r\n    const tagName: string = PublishUtilities.createTagname(packageName, packageVersion);\r\n    PublishUtilities.execCommand(\r\n      !!this._targetBranch && shouldExecute,\r\n      'git',\r\n      ['tag', '-a', tagName, '-m', `${packageName} v${packageVersion}`]);\r\n  }\r\n\r\n  public commit(commitMessage: string): void {\r\n    PublishUtilities.execCommand(!!this._targetBranch, 'git', ['commit', '-m', commitMessage]);\r\n  }\r\n\r\n  public push(branchName: string | undefined): void {\r\n    PublishUtilities.execCommand(\r\n      !!this._targetBranch,\r\n      'git',\r\n      // We append \"--no-verify\" to prevent Git hooks from running.  For example, people may\r\n      // want to invoke \"rush change -v\" as a pre-push hook.\r\n      ['push', 'origin', 'HEAD:' + branchName, '--follow-tags', '--verbose', '--no-verify']);\r\n  }\r\n}\r\n"]}